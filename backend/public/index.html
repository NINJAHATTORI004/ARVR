<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARVA - QIE Blockchain Hackathon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --metamask: #f6851b;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            color: var(--text);
            min-height: 100vh;
        }
        
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: radial-gradient(ellipse at center, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
        }
        
        .logo {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        
        .tagline {
            font-size: 1.3rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .hackathon-badge {
            display: inline-block;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 600;
            margin: 20px 0;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .requirements {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }
        
        .req-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .req-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2);
        }
        
        .req-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .req-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .req-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
        }
        
        .req-status {
            display: inline-block;
            margin-top: 15px;
            padding: 6px 15px;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            border-radius: 20px;
            color: var(--success);
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .wallet-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            border: 2px solid var(--metamask);
            text-align: center;
        }
        
        .wallet-section h2 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .btn-metamask {
            background: linear-gradient(135deg, #f6851b, #e2761b);
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .wallet-info {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            border-radius: 15px;
        }
        
        .wallet-address {
            font-family: monospace;
            font-size: 1.1rem;
            padding: 12px 20px;
            background: var(--bg-dark);
            border-radius: 10px;
            margin: 10px 0;
            word-break: break-all;
        }
        
        .balance {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--success), #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }
        
        .verify-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
        }
        
        .verify-section h2 {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .input-row {
            display: flex;
            gap: 15px;
            max-width: 700px;
            margin: 0 auto 20px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: var(--bg-dark);
            color: var(--text);
            font-size: 1rem;
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .demo-assets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .asset-btn {
            background: var(--bg-dark);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .asset-btn:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .asset-btn.invalid {
            border-color: var(--error);
        }
        
        .asset-btn.invalid:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .asset-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .asset-id {
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .result-box {
            max-width: 700px;
            margin: 25px auto 0;
            padding: 25px;
            border-radius: 15px;
            display: none;
        }
        
        .result-box.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
        }
        
        .result-box.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
        }
        
        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .result-item {
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .result-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .result-value {
            font-weight: 600;
            word-break: break-all;
        }
        
        .footer {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 768px) {
            .requirements { grid-template-columns: 1fr; }
            .input-row { flex-direction: column; }
            .result-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="hero">
        <div class="logo">üîê ARVA</div>
        <p class="tagline">Augmented Reality Verification of Assets</p>
        <div class="hackathon-badge">üèÜ QIE Blockchain Hackathon Submission</div>
    </div>
    
    <div class="container">
        <!-- Requirements -->
        <div class="requirements">
            <div class="req-card">
                <div class="req-icon">üëõ</div>
                <div class="req-title">Wallet Integration</div>
                <div class="req-desc">Full MetaMask integration with QIE network support</div>
                <div class="req-status">‚úÖ Implemented</div>
            </div>
            <div class="req-card">
                <div class="req-icon">‚õìÔ∏è</div>
                <div class="req-title">QIE Testnet</div>
                <div class="req-desc">Deployed on QIE Blockchain (Chain ID: 5656)</div>
                <div class="req-status">‚úÖ Deployed</div>
            </div>
            <div class="req-card">
                <div class="req-icon">üîó</div>
                <div class="req-title">On-Chain Interaction</div>
                <div class="req-desc">Real blockchain verification & NFT minting</div>
                <div class="req-status">‚úÖ Working</div>
            </div>
        </div>
        
        <!-- Wallet Section -->
        <div class="wallet-section">
            <h2>ü¶ä MetaMask Wallet Integration</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px;">
                Connect your wallet to interact with the QIE Blockchain
            </p>
            
            <div id="connectButtons">
                <button class="btn btn-metamask" onclick="connectWallet()">
                    ü¶ä Connect MetaMask
                </button>
                <button class="btn btn-outline" onclick="window.location.href='wallet.html'">
                    üì± Full Wallet Demo ‚Üí
                </button>
            </div>
            
            <div class="wallet-info" id="walletInfo">
                <p style="color: var(--success); font-weight: 600; font-size: 1.2rem;">‚úÖ Wallet Connected!</p>
                <div class="wallet-address" id="walletAddress">-</div>
                <div class="balance" id="walletBalance">0.0000 QIE</div>
                <p style="color: var(--text-muted);">Network: <span id="networkName">-</span></p>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addQIENetwork()">‚ûï Add QIE Network</button>
                    <button class="btn btn-outline" onclick="disconnect()">Disconnect</button>
                </div>
            </div>
        </div>
        
        <!-- Verification Section -->
        <div class="verify-section">
            <h2>üîç Verify Asset On-Chain</h2>
            
            <div class="input-row">
                <input type="text" id="assetId" placeholder="Enter Asset ID (e.g., DEGREE-MIT-2024-001)">
                <button class="btn btn-primary" onclick="verifyAsset()">Verify</button>
            </div>
            
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 15px;">
                Or click a demo asset below:
            </p>
            
            <div class="demo-assets">
                <div class="asset-btn" onclick="verifyAsset('DEGREE-MIT-2024-001')">
                    <div class="asset-name">üìú MIT Degree</div>
                    <div class="asset-id">DEGREE-MIT-2024-001</div>
                </div>
                <div class="asset-btn" onclick="verifyAsset('LUXURY-ROLEX-SUB-2024-ABC123')">
                    <div class="asset-name">‚åö Rolex Watch</div>
                    <div class="asset-id">LUXURY-ROLEX-SUB-2024-ABC123</div>
                </div>
                <div class="asset-btn" onclick="verifyAsset('CERT-AWS-SAA-2024-XYZ789')">
                    <div class="asset-name">üéì AWS Certificate</div>
                    <div class="asset-id">CERT-AWS-SAA-2024-XYZ789</div>
                </div>
                <div class="asset-btn" onclick="verifyAsset('ART-PICASSO-AUTH-2024-P001')">
                    <div class="asset-name">üé® Picasso Print</div>
                    <div class="asset-id">ART-PICASSO-AUTH-2024-P001</div>
                </div>
                <div class="asset-btn invalid" onclick="verifyAsset('FAKE-DEGREE-NOTREAL-2024')">
                    <div class="asset-name">‚ùå Fake Degree</div>
                    <div class="asset-id">FAKE-DEGREE-NOTREAL-2024</div>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Verifying on QIE Blockchain...</p>
            </div>
            
            <div class="result-box" id="result"></div>
        </div>
        
        <div class="footer">
            <p>Built for QIE Blockchain Hackathon 2024</p>
            <p style="margin-top: 10px;">Contract: 0x5FbDB2315678afecb367f032d93F642f64180aa3</p>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:3001';
        let provider = null;
        let connectedAddress = null;
        
        // Check for existing connection on load
        document.addEventListener('DOMContentLoaded', async () => {
            if (window.ethereum) {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    connectedAddress = accounts[0];
                    await updateWalletDisplay();
                }
                
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        connectedAddress = accounts[0];
                        updateWalletDisplay();
                    } else {
                        disconnect();
                    }
                });
                
                window.ethereum.on('chainChanged', () => updateWalletDisplay());
            }
        });
        
        async function connectWallet() {
            if (!window.ethereum) {
                alert('Please install MetaMask!');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }
            
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                connectedAddress = accounts[0];
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await updateWalletDisplay();
            } catch (error) {
                console.error('Connection error:', error);
                if (error.code !== 4001) {
                    alert('Failed to connect: ' + error.message);
                }
            }
        }
        
        async function updateWalletDisplay() {
            if (!connectedAddress) return;
            
            document.getElementById('connectButtons').style.display = 'none';
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('walletAddress').textContent = connectedAddress;
            
            // Get balance
            try {
                if (!provider) provider = new ethers.providers.Web3Provider(window.ethereum);
                const balance = await provider.getBalance(connectedAddress);
                const formatted = parseFloat(ethers.utils.formatEther(balance)).toFixed(4);
                document.getElementById('walletBalance').textContent = `${formatted} QIE`;
            } catch (e) {
                document.getElementById('walletBalance').textContent = '-- QIE';
            }
            
            // Get network
            const chainId = await window.ethereum.request({ method: 'eth_chainId' });
            const chainIdDec = parseInt(chainId, 16);
            let networkName = `Chain ${chainIdDec}`;
            if (chainId === '0x1618') networkName = 'QIE Blockchain ‚úÖ';
            else if (chainId === '0x7a69') networkName = 'Hardhat Local';
            document.getElementById('networkName').textContent = networkName;
        }
        
        async function addQIENetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x1618',
                        chainName: 'QIE Blockchain',
                        nativeCurrency: { name: 'QIE', symbol: 'QIE', decimals: 18 },
                        rpcUrls: ['https://rpc-main1.qiblockchain.online'],
                        blockExplorerUrls: ['https://mainnet.qiblockchain.online']
                    }]
                });
                alert('QIE Network added!');
            } catch (error) {
                if (error.code !== 4001) alert('Failed to add network');
            }
        }
        
        function disconnect() {
            connectedAddress = null;
            provider = null;
            document.getElementById('connectButtons').style.display = 'block';
            document.getElementById('walletInfo').style.display = 'none';
        }
        
        async function verifyAsset(assetId) {
            const id = assetId || document.getElementById('assetId').value.trim();
            if (!id) {
                alert('Please enter an Asset ID');
                return;
            }
            
            document.getElementById('assetId').value = id;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            try {
                const res = await fetch(`${API_URL}/api/verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uniqueId: id })
                });
                
                const data = await res.json();
                document.getElementById('loading').style.display = 'none';
                
                const resultBox = document.getElementById('result');
                resultBox.style.display = 'block';
                
                if (data.isVerified) {
                    resultBox.className = 'result-box success';
                    resultBox.innerHTML = `
                        <div class="result-title" style="color: var(--success);">‚úÖ Asset Verified!</div>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">Token ID</div>
                                <div class="result-value">${data.tokenId}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Asset Type</div>
                                <div class="result-value">${data.assetType}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Issuer DID</div>
                                <div class="result-value" style="font-size: 0.85rem;">${data.issuerDID}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Owner</div>
                                <div class="result-value" style="font-size: 0.85rem;">${data.owner?.slice(0, 10)}...${data.owner?.slice(-6)}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Minted At</div>
                                <div class="result-value">${new Date(data.mintedAt).toLocaleString()}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Network</div>
                                <div class="result-value">${data.blockchainNetwork}</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultBox.className = 'result-box error';
                    resultBox.innerHTML = `
                        <div class="result-title" style="color: var(--error);">‚ùå Asset NOT Verified</div>
                        <p style="color: var(--text-muted);">${data.message || 'This asset is not registered on the QIE blockchain.'}</p>
                    `;
                }
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                const resultBox = document.getElementById('result');
                resultBox.style.display = 'block';
                resultBox.className = 'result-box error';
                resultBox.innerHTML = `
                    <div class="result-title" style="color: var(--error);">‚ö†Ô∏è Connection Error</div>
                    <p style="color: var(--text-muted);">Could not connect to the verification server. Make sure the backend is running.</p>
                `;
            }
        }
    </script>
</body>
</html>
